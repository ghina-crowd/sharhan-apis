"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CachedImage = void 0;
const logger_1 = require("./logger");
class CachedImage {
    constructor(cache, adapter) {
        this.cache = cache;
        this.adapter = adapter;
        this.log = logger_1.getLogger('cached-image');
    }
    async fetch(id) {
        const cacheKey = `image:${id}`;
        let image = await this.cache.get(cacheKey);
        if (image) {
            this.log(`Serving original image ${cacheKey} from cache ...`);
            return image;
        }
        image = await this.adapter.fetch(id);
        if (image) {
            this.log(`Caching original image ${id} ...`);
            await this.cache.set(cacheKey, image);
        }
        return image;
    }
}
exports.CachedImage = CachedImage;
//# sourceMappingURL=cached-image.js.map